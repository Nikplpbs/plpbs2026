<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Store Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">

    <div class="max-w-4xl mx-auto bg-white p-6 rounded-xl shadow-md">
        <h1 class="text-2xl font-bold mb-6 text-gray-800 text-center">แดชบอร์ดข้อมูลร้านค้า</h1>

        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">กรุณาเลือก รหัสร้าน:</label>
            <select id="storeSelect" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                <option value="">-- กำลังเชื่อมต่อข้อมูล... --</option>
            </select>
        </div>

        <div class="overflow-x-auto">
            <table class="min-w-full table-auto border-collapse border border-gray-200">
                <thead>
                    <tr class="bg-gray-100 text-sm font-semibold text-gray-600">
                        <th class="px-4 py-2 border">เบอร์ผู้สั่ง</th>
                        <th class="px-4 py-2 border">ชื่อผู้สั่ง</th>
                        <th class="px-4 py-2 border">ราคาสุทธิ</th>
                        <th class="px-4 py-2 border">เวลารับสินค้า</th>
                    </tr>
                </thead>
                <tbody id="tableBody" class="text-gray-700 text-sm">
                    <tr>
                        <td colspan="4" class="px-4 py-10 text-center text-gray-400">กรุณาเลือกรหัสร้านค้าด้านบน</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // ใช้ URL เว็บแอปของคุณที่นี่
        const API_URL = "https://script.google.com/macros/s/AKfycbwgdSXmpSRtRbGRhM0Qz-2kojNGnHSkk1XdW7yqo6W8SWSYrAWyTDRozPQQQvmdp3wr/exec"; 
        let allData = [];

        async function fetchData() {
            const select = document.getElementById('storeSelect');
            try {
                const response = await fetch(API_URL);
                const textData = await response.text(); // รับเป็น Text เพื่อเลี่ยง CORS
                allData = JSON.parse(textData); // แปลงเป็น JSON เอง
                
                console.log("Data Loaded Successfully");
                populateDropdown(allData);
            } catch (error) {
                console.error("Fetch Error:", error);
                select.innerHTML = '<option>ไม่สามารถโหลดข้อมูลได้ (ตรวจสอบ CORS/URL)</option>';
            }
        }

        function populateDropdown(data) {
            const select = document.getElementById('storeSelect');
            // หาคอลัมน์ 'รหัสร้าน' แบบไม่สนช่องว่าง
            const stores = [...new Set(data.map(item => {
                const key = Object.keys(item).find(k => k.trim() === 'รหัสร้าน');
                return item[key];
            }))].filter(s => s);
